<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è™šæ‹Ÿç”µå‚ VPP - æŠ•èµ„ç³»ç»Ÿ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      min-height: 100vh;
      color: #fff;
      padding: 20px;
    }
    .container { max-width: 600px; margin: 0 auto; }
    
    h1 { text-align: center; margin-bottom: 10px; font-size: 2em; }
    h1 span { color: #f39c12; }
    .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
    
    .card {
      background: rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .card h2 { margin-bottom: 15px; font-size: 1.1em; color: #f39c12; }
    
    .industry { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
      transition: background 0.2s;
    }
    .industry:hover { background: rgba(255,255,255,0.05); }
    .industry:last-child { border-bottom: none; }
    .ind-name { font-weight: 500; }
    .ind-index { font-size: 1.3em; color: #f39c12; font-weight: bold; }
    .ind-risk { 
      padding: 3px 10px; 
      border-radius: 10px; 
      font-size: 0.75em;
    }
    .risk-high { background: #e74c3c; }
    .risk-medium { background: #f39c12; }
    .risk-low { background: #27ae60; }
    
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .stat { 
      text-align: center; 
      padding: 15px 10px; 
      background: rgba(255,255,255,0.05); 
      border-radius: 12px; 
    }
    .stat-value { font-size: 1.4em; color: #f39c12; font-weight: bold; }
    .stat-label { color: #888; font-size: 0.8em; margin-top: 5px; }
    
    .invest-form { margin-top: 15px; }
    .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
    select, input { 
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 1em;
    }
    select option { background: #302b63; }
    
    .btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #f39c12, #e67e22);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(243,156,18,0.3); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .result { 
      margin-top: 15px; 
      padding: 15px; 
      background: rgba(39,174,96,0.2); 
      border-radius: 10px;
      display: none;
    }
    .result.show { display: block; }
    .result pre { 
      font-size: 0.7em; 
      word-break: break-all; 
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }
    
    .footer { text-align: center; margin-top: 30px; color: #666; font-size: 0.8em; }
    
    .loading { text-align: center; color: #888; padding: 20px; }
    .refresh { 
      text-align: center; 
      margin-bottom: 20px; 
      color: #666; 
      font-size: 0.8em; 
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>âš¡ è™šæ‹Ÿç”µå‚ <span>VPP</span></h1>
    <p class="subtitle">åˆ†å¸ƒå¼èƒ½æºæŠ•èµ„ç³»ç»Ÿ</p>
    
    <div class="refresh">ç‚¹å‡»æŒ‡æ•°åˆ·æ–°æ•°æ®</div>
    
    <div class="card">
      <h2>ğŸ“Š èƒ½æºæŒ‡æ•°</h2>
      <div id="indices">
        <div class="loading">åŠ è½½ä¸­...</div>
      </div>
    </div>
    
    <div class="card">
      <h2>ğŸ“ˆ ç³»ç»Ÿç»Ÿè®¡</h2>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="investors">-</div>
          <div class="stat-label">æŠ•èµ„è€…</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="invested">-</div>
          <div class="stat-label">æ€»æŠ•èµ„(sats)</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="revenue">-</div>
          <div class="stat-label">æ—¥æ”¶ç›Š($)</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>âš¡ æŠ•èµ„</h2>
      <div class="invest-form">
        <div class="form-row">
          <select id="industry">
            <option value="solar">â˜€ï¸ è™šæ‹Ÿå¤ªé˜³èƒ½</option>
            <option value="storage">ğŸ”‹ è™šæ‹Ÿå‚¨èƒ½</option>
            <option value="demand">âš¡ è™šæ‹Ÿéœ€æ±‚å“åº”</option>
            <option value="carbon">ğŸŒ± è™šæ‹Ÿç¢³ä¿¡ç”¨</option>
          </select>
        </div>
        <div class="form-row">
          <input type="number" id="sats" placeholder="æŠ•èµ„é‡‘é¢ (sats)" value="100" min="10">
        </div>
        <button class="btn" onclick="generateInvoice()">âš¡ ç”Ÿæˆæ”¯ä»˜ Invoice</button>
        
        <div class="result" id="result">
          <div>âœ… Invoice å·²ç”Ÿæˆï¼</div>
          <pre id="invoiceText"></pre>
          <div style="margin-top:10px;color:#888;font-size:0.8em;">å¤åˆ¶ä¸Šæ–¹ Invoiceï¼Œä½¿ç”¨ä»»ä½• Lightning é’±åŒ…æ”¯ä»˜</div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      Powered by Virtual Corp VPP | Lightning Network<br>
      Demo Version - Verceléƒ¨ç½²
    </div>
  </div>
  
  <script>
    const API = '/api';
    
    async function loadIndices() {
      const res = await fetch(`${API}?action=list`);
      const data = await res.json();
      
      let html = '';
      for (const [key, val] of Object.entries(data.data)) {
        html += `
          <div class="industry" onclick="loadIndices()">
            <span class="ind-name">${val.name}</span>
            <span class="ind-index">${val.index}</span>
            <span class="ind-risk risk-${val.risk}">${val.risk}</span>
          </div>
        `;
      }
      document.getElementById('indices').innerHTML = html;
    }
    
    async function loadStats() {
      const res = await fetch(`${API}?action=stats`);
      const data = await res.json();
      
      document.getElementById('investors').textContent = data.data.totalInvestors;
      document.getElementById('invested').textContent = data.data.totalInvested;
      document.getElementById('revenue').textContent = '$' + Math.floor(data.data.dailyRevenue);
    }
    
    async function generateInvoice() {
      const sats = document.getElementById('sats').value;
      const industry = document.getElementById('industry').value;
      
      const btn = document.querySelector('.btn');
      btn.disabled = true;
      btn.textContent = 'â³ ç”Ÿæˆä¸­...';
      
      try {
        const res = await fetch(`${API}?action=invoice&sats=${sats}&industry=${industry}`);
        const data = await res.json();
        
        document.getElementById('result').classList.add('show');
        document.getElementById('invoiceText').textContent = data.data.invoice;
        
        btn.textContent = 'âœ… å·²ç”Ÿæˆï¼';
      } catch (e) {
        btn.textContent = 'âŒ ç”Ÿæˆå¤±è´¥';
      }
      
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = 'âš¡ é‡æ–°ç”Ÿæˆæ”¯ä»˜ Invoice';
      }, 3000);
    }
    
    loadIndices();
    loadStats();
    setInterval(() => { loadIndices(); loadStats(); }, 30000);
  </script>
</body>
</html>
