<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virtual Corp VPP - åˆ†å¸ƒå¼èƒ½æºæŠ•èµ„å¹³å°</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      min-height: 100vh;
      color: #fff;
      padding: 20px;
    }
    .container { max-width: 600px; margin: 0 auto; }
    
    h1 { text-align: center; margin-bottom: 5px; font-size: 1.8em; }
    h1 span { color: #f39c12; }
    .subtitle { text-align: center; color: #888; margin-bottom: 20px; font-size: 0.9em; }
    
    .card {
      background: rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 15px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .card h2 { margin-bottom: 12px; font-size: 1em; color: #f39c12; }
    
    .industry { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
    }
    .industry:hover { background: rgba(255,255,255,0.05); }
    .industry:last-child { border-bottom: none; }
    
    .ind-info { flex: 1; }
    .ind-name { font-weight: 500; font-size: 0.95em; }
    .ind-desc { color: #888; font-size: 0.75em; }
    .ind-index { font-size: 1.2em; color: #f39c12; font-weight: bold; }
    .ind-risk { 
      padding: 2px 8px; border-radius: 8px; font-size: 0.7em; margin-left: 10px;
    }
    .risk-high { background: #e74c3c; }
    .risk-medium { background: #f39c12; }
    .risk-low { background: #27ae60; }
    
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .stat { text-align: center; padding: 12px 8px; background: rgba(255,255,255,0.05); border-radius: 10px; }
    .stat-value { font-size: 1.2em; color: #f39c12; font-weight: bold; }
    .stat-label { color: #888; font-size: 0.7em; margin-top: 3px; }
    
    .form-row { display: flex; gap: 8px; margin-bottom: 10px; }
    select, input, button { 
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 0.95em;
    }
    select option { background: #302b63; }
    
    .btn {
      background: linear-gradient(135deg, #f39c12, #e67e22);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .btn:hover { transform: translateY(-2px); }
    
    .result { margin-top: 12px; padding: 12px; background: rgba(39,174,96,0.2); border-radius: 10px; display: none; }
    .result.show { display: block; }
    .result pre { font-size: 0.65em; word-break: break-all; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; margin-top: 8px; }
    
    .portfolio { margin-top: 10px; }
    .portfolio-item { padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; }
    .portfolio-item .ind { font-weight: bold; }
    .portfolio-item .val { color: #f39c12; font-size: 0.9em; }
    .portfolio-item .gain { font-size: 0.8em; }
    .gain.pos { color: #27ae60; }
    .gain.neg { color: #e74c3c; }
    
    .footer { text-align: center; margin-top: 25px; color: #666; font-size: 0.75em; }
    
    .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
    .tab { flex: 1; padding: 10px; text-align: center; background: rgba(255,255,255,0.05); border-radius: 10px; cursor: pointer; }
    .tab.active { background: #f39c12; color: #000; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <h1>âš¡ Virtual Corp <span>VPP</span></h1>
    <p class="subtitle">åˆ†å¸ƒå¼èƒ½æºæŠ•èµ„å¹³å° | Lightning Powered</p>
    
    <div class="tabs">
      <div class="tab active" onclick="switchTab('invest')">æŠ•èµ„</div>
      <div class="tab" onclick="switchTab('portfolio')">æˆ‘çš„ç»„åˆ</div>
      <div class="tab" onclick="switchTab('stats')">ç»Ÿè®¡</div>
    </div>
    
    <div class="tab-content active" id="tab-invest">
      <div class="card">
        <h2>ğŸ“Š èƒ½æºæŒ‡æ•° (ç‚¹å‡»åˆ·æ–°)</h2>
        <div id="indices"><div class="loading">åŠ è½½ä¸­...</div></div>
      </div>
      
      <div class="card">
        <h2>âš¡ æŠ•èµ„</h2>
        <div class="form-row">
          <select id="industry">
            <option value="solar">â˜€ï¸ è™šæ‹Ÿå¤ªé˜³èƒ½</option>
            <option value="storage">ğŸ”‹ è™šæ‹Ÿå‚¨èƒ½</option>
            <option value="demand">âš¡ éœ€æ±‚å“åº”</option>
            <option value="carbon">ğŸŒ± ç¢³ä¿¡ç”¨</option>
          </select>
        </div>
        <div class="form-row">
          <input type="number" id="sats" placeholder="æŠ•èµ„é‡‘é¢ (sats)" value="100" min="10">
          <input type="text" id="username" placeholder="ç”¨æˆ·å" value="vincentyy">
        </div>
        <button class="btn" onclick="doInvest()">âš¡ ç«‹å³æŠ•èµ„</button>
        
        <div class="result" id="result">
          <div>âœ… æŠ•èµ„æˆåŠŸï¼</div>
          <pre id="resultData"></pre>
        </div>
      </div>
    </div>
    
    <div class="tab-content" id="tab-portfolio">
      <div class="card">
        <h2>ğŸ’¼ æˆ‘çš„æŠ•èµ„ç»„åˆ</h2>
        <div class="form-row">
          <input type="text" id="pfUser" placeholder="ç”¨æˆ·å" value="vincentyy">
          <button class="btn" onclick="loadPortfolio()" style="flex:0.5">æŸ¥çœ‹</button>
        </div>
        <div id="portfolio"><div class="loading">è¾“å…¥ç”¨æˆ·åæŸ¥çœ‹ç»„åˆ</div></div>
      </div>
    </div>
    
    <div class="tab-content" id="tab-stats">
      <div class="card">
        <h2>ğŸ“ˆ ç³»ç»Ÿç»Ÿè®¡</h2>
        <div class="stats">
          <div class="stat"><div class="stat-value" id="statInvestors">-</div><div class="stat-label">æŠ•èµ„è€…</div></div>
          <div class="stat"><div class="stat-value" id="statInvested">-</div><div class="stat-label">æ€»æŠ•èµ„(sats)</div></div>
          <div class="stat"><div class="stat-value" id="statRevenue">-</div><div class="stat-label">æ—¥æ”¶ç›Š($)</div></div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      Powered by Virtual Corp VPP | Lightning Network<br>
      v2.0 - Multi-user Support
    </div>
  </div>
  
  <script>
    const API = '/api';
    
    function switchTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('tab-' + tab).classList.add('active');
      if(tab === 'stats') loadStats();
    }
    
    async function loadIndices() {
      const res = await fetch(`${API}?action=list`);
      const data = await res.json();
      
      let html = '';
      for (const [key, val] of Object.entries(data.data)) {
        html += `
          <div class="industry" onclick="loadIndices()">
            <div class="ind-info">
              <div class="ind-name">${val.name}</div>
              <div class="ind-desc">${val.desc}</div>
            </div>
            <span class="ind-index">${val.index}</span>
            <span class="ind-risk risk-${val.risk}">${val.risk}</span>
          </div>
        `;
      }
      document.getElementById('indices').innerHTML = html;
    }
    
    async function doInvest() {
      const sats = document.getElementById('sats').value;
      const industry = document.getElementById('industry').value;
      const user = document.getElementById('username').value;
      
      const btn = document.querySelector('#tab-invest .btn');
      btn.disabled = true; btn.textContent = 'â³ æŠ•èµ„ä¸­...';
      
      const res = await fetch(`${API}?action=invest&user=${user}&sats=${sats}&industry=${industry}`);
      const data = await res.json();
      
      document.getElementById('result').classList.add('show');
      document.getElementById('resultData').textContent = JSON.stringify(data, null, 2);
      
      btn.disabled = false; btn.textContent = 'âš¡ ç«‹å³æŠ•èµ„';
    }
    
    async function loadPortfolio() {
      const user = document.getElementById('pfUser').value;
      const res = await fetch(`${API}?action=portfolio&user=${user}`);
      const data = await res.json();
      
      if (!data.success) {
        document.getElementById('portfolio').innerHTML = '<div>ç”¨æˆ·ä¸å­˜åœ¨</div>';
        return;
      }
      
      let html = '';
      data.data.portfolio.forEach(p => {
        const gain = p.currentValue - p.sats;
        const gainClass = gain >= 0 ? 'pos' : 'neg';
        html += `
          <div class="portfolio-item">
            <div class="ind">${p.industry}</div>
            <div class="val">${p.sats} sats â†’ ${p.currentValue} sats</div>
            <div class="gain ${gainClass}">${gain >= 0 ? '+' : ''}${gain} sats</div>
          </div>
        `;
      });
      
      html += `<div style="margin-top:10px;font-weight:bold;">æ€»ä»·å€¼: ${data.data.totalValue} sats</div>`;
      document.getElementById('portfolio').innerHTML = html;
    }
    
    async function loadStats() {
      const res = await fetch(`${API}?action=stats`);
      const data = await res.json();
      document.getElementById('statInvestors').textContent = data.data.totalInvestors;
      document.getElementById('statInvested').textContent = data.data.totalInvested;
      document.getElementById('statRevenue').textContent = '$' + Math.floor(data.data.dailyRevenue);
    }
    
    loadIndices();
    setInterval(loadIndices, 30000);
  </script>
</body>
</html>
